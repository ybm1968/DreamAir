<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/UI/layout/main_layout}"
      >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œë°œì„ ê¿ˆê¾¸ëŠ” í•­ê³µì‚¬</title>

    <!-- main_layoutì— ì ìš©ë˜ì–´ìˆëŠ” style.cssê°€ ì•„ë‹Œ checkIn.cssë¥¼ ìš°ì„  ì ìš© -->
    <link rel="stylesheet" th:href="@{/css/checkIn.css}" />


    <!-- JavaScript ì¶”ê°€ -->
    <script th:inline="javascript">

        let booking = [[${booking}]]        // ì—¬ê¸°ëŠ” ì›ë˜ ì—ëŸ¬ ëœ¨ëŠ” ê²ƒì„ ë¬´ì‹œ ê°€ëŠ¥
        let selectable = true               // ì¢Œì„ ì„ íƒ ê°€ëŠ¥ ì—¬ë¶€
        console.log( booking );
        console.log( booking.pasCount );

        document.addEventListener('DOMContentLoaded', function() {

            // checkboxì˜ change ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë“±ë¡
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            var depSeatInput = document.getElementById('depSeat');

            var selectedSeats = new Array()

            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {

                    // ì²´í¬ í•´ì œì¸ ê²½ìš° (ğŸŸ¦)
                    if(  checkbox.classList.contains('checked')  ) {
                        checkbox.classList.remove('checked')
                        checkbox.checked = false                // ì„ íƒí•œ ì²´í¬ ë°•ìŠ¤ë¥¼ ì„ íƒ í•´ì œ (âœ…  -->  ğŸŸ©)
                    }
                    
                    selectedSeats = Array.from(checkboxes)
                                        .filter(function(checkbox) { return checkbox.checked; })
                                        .map(function(checkbox) { return checkbox.value; });
                    console.log('selectedSeats : '+ selectedSeats);
                    
                    if( (booking.pasCount < selectedSeats.length) ) {
                        alert('ì„ íƒ ë¶ˆê°€')
                        checkbox.checked = false
                        return                   // ì„ íƒ ì¢Œì„ ìˆ˜ > íƒ‘ìŠ¹ì¸ì› ìˆ˜ (ì„ íƒ ë¶ˆê°€)
                    }

                    // input ì„ íƒëœ ì¢Œì„ ë„£ì–´ì£¼ê¸°
                    depSeatInput.value = selectedSeats.join(', ');

                    // ì²´í¬ ë°•ìŠ¤ ì„ íƒ(ğŸŸ¥)
                    console.log('checkbox.checked : ' + checkbox.checked);
                    if( checkbox.checked )
                        checkbox.classList.add('checked')

                    console.log('ì„ íƒëœ ì¢Œì„ ìˆ˜ : ' +  selectedSeats.length );
                });
            });
        });

    </script>


</head>


<body layout:fragment="content">

    <div class="seat-content">
        <div class="seat-header">
            <h2 class="text">ì¢Œì„ì„ íƒ</h2>
        </div>

        <div class="seat-header2">
            <h2>ê°€ëŠ” í¸</h2>
        </div>


        <div class="seat-body">
            <form action="./notice" method="post" id="frm3">
            <!-- csrf -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div class="seatInnerWrap">
                    <div class="seatInnerLeft">
                        <div class="left1">
                            <div class="nameView"></div>
                            <div class="seatView">
                                <div class="depAir">
                                    <div class="depSeat">

                                        <br>

                                        <h5 class="seatCol">A ã€€B ã€€C ã€€D</h5>
                                        <!-- ì¢Œì„ -->
                                        <div class="seat1">
                                            <th:block th:each="seat, iterStat : ${seatStatus}">
                                                <input type="checkbox" class="seatBox" th:value="${seat.seatNo}" th:id="'seat-' + ${seat.seatNo}" th:disabled="${seat.status}==1" />
                                                <label th:for="'seat-' + ${seat.seatNo}" th:text="${seat.seatNo}"></label>
                                                <th:block th:if="${iterStat.count % 4 == 0}">
                                                    <br />
                                                </th:block>
                                                <th:block th:if="${iterStat.count % 40 == 0}">
                                                    <br />
                                                </th:block>
                                            </th:block>
                                        </div>

                                    </div>
                                </div>

                                
                            </div>

                        </div>
                    </div>

                    <!-- <p th:text="${booking}"></p> -->

                    <div class="seatInnerRight">
                        <div class="seatInnerRightTop">
                            <div class="seatInfo">
                                <div class="seatInfo_bookSeat"><img alt="" src="/img/bookableSeat.png"> ì„ íƒ ê°€ëŠ¥ ì¢Œì„ </div>
                                <div class="seatInfo_bookingSeat"><img alt="" src="/img/bookingSeat.png"> ì„ íƒí•œ ì¢Œì„ </div>
                                <div class="seatInfo_bookedSeat"><img alt="" src="/img/bookedSeat.png"> ì„ íƒ ë¶ˆê°€ ì¢Œì„ </div>
                            </div>
                        </div>
                        
                        
                        <div class="seatInnerRightDown">
                            <div class="passengerName">íƒ‘ìŠ¹ê° ëª…
                                <h5 th:each="passenger : ${booking.passengerNames}">
                                    <span th:text="${passenger}"></span>
                                </h5>
                            </div>
                            <br>
                            <div>ì¸ì› ìˆ˜
                                <span class="spanPeople" th:text="${booking.pasCount}"></span>ëª…
                            </div>
                            <br>
                            <div class="goSeat">ê°€ëŠ” í¸ ì¢Œì„
                                <input type="text" id="depSeat" name="depSeat" readonly="readonly" style="padding: 0; height: 17px">
                            </div>
                            
                            
                            <!-- <input type="text" id="depFNum" name="depFNum" readonly="readonly" hidden="hidden">
                                <input type="text" class="roundOnly" id="arrFNum" name="arrFNum" readonly="readonly" hidden="hidden">
                                <input type="text" id="kind" name="kind" readonly="readonly" hidden="hidden"> -->
                            </div>
                        </div>
                        
                    </div>
                    
                <th:block th:if="${booking.roundTrip == 'ì™•ë³µ'}">
                    ë‹¤ìŒ í˜ì´ì§€ë¡œ ê°€ëŠ” ë²„íŠ¼
                    <button type="submit" class="seatInnerBottom" id="btn">
                        <span>ì„ íƒ ì™„ë£Œ</span>
                    </button>
                </th:block>
                <th:block th:unless="${booking.roundTrip == 'ì™•ë³µ'}">
                    <button type="submit" class="seatInnerBottom" id="btn">
                        <span>ì„ íƒ ì™„ë£Œ</span>
                    </button>
                </th:block>
 
            </form>
        </div>
    </div>

</body>
</html>