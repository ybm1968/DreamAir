<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/UI/layout/main_layout}"
      >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í∞úÎ∞úÏùÑ ÍøàÍæ∏Îäî Ìï≠Í≥µÏÇ¨</title>

    <!-- main_layoutÏóê Ï†ÅÏö©ÎêòÏñ¥ÏûàÎäî style.cssÍ∞Ä ÏïÑÎãå checkIn.cssÎ•º Ïö∞ÏÑ† Ï†ÅÏö© -->
    <link rel="stylesheet" th:href="@{/css/checkIn.css}" />


    <script th:inline="javascript">

        let booking = [[${booking}]]        // Ïó¨Í∏∞Îäî ÏõêÎûò ÏóêÎü¨ Îú®Îäî Í≤ÉÏûÑ Î¨¥Ïãú Í∞ÄÎä•
        let selectable = true               // Ï¢åÏÑù ÏÑ†ÌÉù Í∞ÄÎä• Ïó¨Î∂Ä
        console.log( booking );
        console.log( booking.pasCount );

        document.addEventListener('DOMContentLoaded', function() {

            // checkboxÏùò change Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ Îì±Î°ù
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            var depSeatInput = document.getElementById('depSeat');
            var seatNoDepsInput = document.getElementById('seatNoDeps');  // Ï∂îÍ∞Ä Î∂ÄÎ∂Ñ

            var selectedSeats = new Array();

            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {

                    // Ï≤¥ÌÅ¨ Ìï¥Ï†úÏù∏ Í≤ΩÏö∞ (üü¶)
                    if (checkbox.classList.contains('checked')) {
                        checkbox.classList.remove('checked');
                        checkbox.checked = false;  // ÏÑ†ÌÉùÌïú Ï≤¥ÌÅ¨ Î∞ïÏä§Î•º ÏÑ†ÌÉù Ìï¥Ï†ú (‚úÖ  -->  üü©)
                    }

                    selectedSeats = Array.from(checkboxes)
                        .filter(function(checkbox) { return checkbox.checked; })
                        .map(function(checkbox) { return checkbox.value; });
                    console.log('selectedSeats : ' + selectedSeats);

                    if (booking.pasCount < selectedSeats.length) {
                        alert('ÏÑ†ÌÉù Î∂àÍ∞Ä');
                        checkbox.checked = false;
                        return;  // ÏÑ†ÌÉù Ï¢åÏÑù Ïàò > ÌÉëÏäπÏù∏Ïõê Ïàò (ÏÑ†ÌÉù Î∂àÍ∞Ä)
                    }

                    // input ÏÑ†ÌÉùÎêú Ï¢åÏÑù ÎÑ£Ïñ¥Ï£ºÍ∏∞
                    depSeatInput.value = selectedSeats.join(', ');

                    // seatNoDeps Í∞í ÏÑ§Ï†ï
                    booking.seatNoDeps = selectedSeats;
                    seatNoDepsInput.value = selectedSeats.join(',');

                    // Ï≤¥ÌÅ¨ Î∞ïÏä§ ÏÑ†ÌÉù(üü•)
                    console.log('checkbox.checked : ' + checkbox.checked);
                    if (checkbox.checked)
                        checkbox.classList.add('checked');

                    console.log('ÏÑ†ÌÉùÎêú Ï¢åÏÑù Ïàò : ' + selectedSeats.length);
                });
            });
        });

    </script>


 
</head>

<body layout:fragment="content">

    <div class="seat-content">
        <div class="seat-header">
            <h2 class="text">Ï¢åÏÑùÏÑ†ÌÉù</h2>
        </div>

        <div class="seat-header2">
            <h2>Í∞ÄÎäî Ìé∏</h2>
        </div>

        <div class="seat-body">
            <form action="./notice" method="post" id="frm3">
                <!-- input : hiddenÏúºÎ°ú Îç∞Ïù¥ÌÑ∞ ÎÑòÍ∏∞Í∏∞ -->
                <input type="hidden" name="pasCount" id="pasCount" th:value="${booking.pasCount}">
                <input type="hidden" name="roundTrip" id="roundTrip" th:value="${booking.roundTrip}">
                <th:block th:with="count=${booking.pasCount}">
                    <th:block th:each="i : ${#numbers.sequence(1, count)}">
                        <input type="hidden" name="passengerNames" id="passengerNames" th:value="${booking.passengerNames[i-1]}" th:attr="data-index=${i-1}" />
                    </th:block>
                </th:block>
                <th:block th:with="count=${booking.pasCount}">
                    <th:block th:each="i : ${#numbers.sequence(1, count)}">
                        <input type="hidden" name="passengerNoss" id="passengerNoss" th:value="${booking.passengerNoss[i-1]}" th:attr="data-index=${i-1}" />
                    </th:block>
                </th:block>
                <input type="hidden" id="seatNoDeps" name="seatNoDeps" th:value="${booking.seatNoDeps}" />
                <th:block th:with="count=${booking.pasCount}">
                    <th:block th:each="i : ${#numbers.sequence(1, count)}">
                        <input type="hidden" name="routeNoDess" id="routeNoDess" th:value="${booking.routeNoDess[i-1]}" th:attr="data-index=${i-1}" />
                    </th:block>
                </th:block>
                <input type="hidden" name="destination" id="destination" th:value="${booking.destination}">
                <th:block th:with="count=${booking.pasCount}">
                    <th:block th:each="i : ${#numbers.sequence(1, count)}">
                        <input type="hidden" name="phones" id="phones" th:value="${booking.phones[i-1]}" th:attr="data-index=${i-1}" />
                    </th:block>
                </th:block>


            <!-- csrf -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <div class="seatInnerWrap">
                    <div class="seatInnerLeft">
                        <div class="left1">
                            <div class="nameView"></div>
                            <div class="seatView">
                                <div class="depAir">
                                    <div class="depSeat">

                                        <br>

                                        <h5 class="seatCol">A „ÄÄB „ÄÄC „ÄÄD</h5>
                                        <!-- Ï¢åÏÑù -->
                                        <div class="seat1">
                                            <th:block th:each="seat, iterStat : ${seatStatus}">
                                                <input type="checkbox" class="seatBox" th:value="${seat.seatNo}" th:id="'seat-' + ${seat.seatNo}" th:disabled="${seat.status}==1" />
                                                <label th:for="'seat-' + ${seat.seatNo}" th:text="${seat.seatNo}"></label>
                                                <th:block th:if="${iterStat.count % 4 == 0}">
                                                    <br />
                                                </th:block>
                                                <th:block th:if="${iterStat.count % 40 == 0}">
                                                    <br />
                                                </th:block>
                                            </th:block>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- <p th:text="${booking}"></p> -->

                    <div class="seatInnerRight">
                        <div class="seatInnerRightTop">
                            <div class="seatInfo">
                                <div class="seatInfo_bookSeat"><img alt="" src="/img/bookableSeat.png"> ÏÑ†ÌÉù Í∞ÄÎä• Ï¢åÏÑù </div>
                                <div class="seatInfo_bookingSeat"><img alt="" src="/img/bookingSeat.png"> ÏÑ†ÌÉùÌïú Ï¢åÏÑù </div>
                                <div class="seatInfo_bookedSeat"><img alt="" src="/img/bookedSeat.png"> ÏÑ†ÌÉù Î∂àÍ∞Ä Ï¢åÏÑù </div>
                            </div>
                        </div>
                        
                        
                        <div class="seatInnerRightDown">
                            <div class="passengerName">ÌÉëÏäπÍ∞ù Î™Ö
                                <h5 th:each="passenger : ${booking.passengerNames}">
                                    <span th:text="${passenger}"></span>
                                </h5>
                            </div>
                            <br>
                            <div>Ïù∏Ïõê Ïàò
                                <span class="spanPeople" th:text="${booking.pasCount}"></span>Î™Ö
                            </div>
                            <br>
                            <div class="goSeat">Í∞ÄÎäî Ìé∏ Ï¢åÏÑù
                                <input type="text" id="depSeat" name="depSeat" readonly="readonly" style="padding: 0; height: 17px">
                            </div>
                            
                        </div>
                    </div>
                        
                </div>
                    
                <th:block th:if="${booking.roundTrip == 'ÏôïÎ≥µ'}">
                    <button type="button" class="seatInnerBottom" id="btn" onclick="goToNextStep()">
                        <span>Îã§Ïùå Îã®Í≥ÑÎ°ú</span>
                    </button>
                </th:block>
                <th:block th:unless="${booking.roundTrip == 'ÏôïÎ≥µ'}">
                    <button type="submit" class="seatInnerBottom" id="btn">
                        <span>ÏÑ†ÌÉù ÏôÑÎ£å</span>
                    </button>
                </th:block>

 
            </form>
        </div>
    </div>

    <script th:inline="javascript">

        let pasCount;
        let roundTrip;
        let seatNoDeps;
        let destination;
    
        function goToNextStep() {
            roundTrip = $("#roundTrip").val();
            pasCount = $("#pasCount").val();
            seatNoDeps = $("#seatNoDeps").val();
            destination = $("#destination").val();
    
            var passengerNames = [];
            for (var i = 0; i < pasCount; i++) {
                var inputValue = $("#passengerNames[data-index='" + i + "']").val();
                passengerNames.push(inputValue);
            }
            
            var commaSeparatedPassengerNames = passengerNames.join(',');    // Î∞∞Ïó¥ÏùÑ ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÎêú Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
            
            var passengerNoss = [];
            for (var i = 0; i < pasCount; i++) {
                var inputValue2 = $("#passengerNoss[data-index='" + i + "']").val();
                passengerNoss.push(inputValue2);
            }
            
            var commaSeparatedPassengerNoss = passengerNoss.join(',');    // Î∞∞Ïó¥ÏùÑ ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÎêú Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò

            var routeNoDess = [];
            for (var i = 0; i < pasCount; i++) {
                var inputValue3 = $("#routeNoDess[data-index='" + i + "']").val();
                routeNoDess.push(inputValue3);
            }
            
            var commaSeparatedRouteNoDess = routeNoDess.join(',');    // Î∞∞Ïó¥ÏùÑ ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÎêú Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
            
            var phones = [];
            for (var i = 0; i < pasCount; i++) {
                var inputValue4 = $("#phones[data-index='" + i + "']").val();
                phones.push(inputValue4);
            }
            
            var commaSeparatedPhones = phones.join(',');    // Î∞∞Ïó¥ÏùÑ ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÎêú Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò
    
            // URLÏóê ÌååÎùºÎØ∏ÌÑ∞ Ï∂îÍ∞Ä
            var url =   "/booking/seat_rt?roundTrip=" + roundTrip
                      + "&pasCount=" + pasCount
                      + "&seatNoDeps=" + seatNoDeps
                      + "&destination=" + destination
                      + "&passengerNames=" + commaSeparatedPassengerNames
                      + "&passengerNoss=" + commaSeparatedPassengerNoss
                      + "&routeNoDess=" + commaSeparatedRouteNoDess
                      + "&phones=" + commaSeparatedPhones
                      ;
            
            // Ïù¥Îèô
            window.location.href = url;
        }
    </script>
</body>
</html>